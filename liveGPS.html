<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Lokasi Terbaru</title>
    <style>
        /* Set the size of the map */
        #map {
            height: 100vh; /* Full height */
            width: 100%; /* Full width */
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCvhYIkXrxYOo7XNjqEgzKf_2ECRN7ovjM"></script> <!-- Ganti YOUR_API_KEY dengan kunci API Google Maps kamu -->
    <script>
        let map;
        let marker;

        function initMap() {
            // Inisialisasi peta di posisi default
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: { lat: -6.2088, lng: 106.8456 }, // Posisi default Jakarta
            });
            marker = new google.maps.Marker({
                position: map.getCenter(),
                map: map,
            });
            fetchData(); // Mengambil data lokasi
            setInterval(fetchData, 5000); // Mengambil data setiap 5 detik
        }

        function fetchData() {
            const url = "https://script.google.com/macros/s/AKfycbypSktIk7s52AeL2T-kQ6ggLjcb4f-b9fmBg0IcLZ8ZR8jSwd_7axgWNlehHPOjerMl/exec"; // Ganti dengan URL Web Apps kamu
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        const lastData = data[data.length - 1]; // Ambil data terakhir
                        const latitude = parseFloat(lastData[1]);
                        const longitude = parseFloat(lastData[2]);

                        if (!isNaN(latitude) && !isNaN(longitude)) {
                            // Memperbarui peta dan marker dengan data lokasi terbaru
                            const newPosition = { lat: latitude, lng: longitude };
                            map.setCenter(newPosition);
                            marker.setPosition(newPosition);
                        } else {
                            console.error("Data latitude/longitude tidak valid:", latitude, longitude);
                        }
                    } else {
                        console.log('Tidak ada data lokasi tersedia.');
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        // Memanggil initMap saat halaman dimuat
        window.onload = initMap;
    </script>
</head>
<body>
    <h1>Peta Lokasi Terbaru</h1>
    <div id="map"></div>
</body>
</html>
